<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•—è¡€ç—‡æ—©æœŸç›£æ§ç³»çµ± - SMART on FHIR Launch</title>
    <script src="https://cdn.jsdelivr.net/npm/fhirclient@5/build/fhir-client.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Microsoft JhengHei', 'Noto Sans TC', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; color: white; text-align: center;
        }
        .launch-container {
            background: rgba(255,255,255,0.15); backdrop-filter: blur(20px);
            border-radius: 30px; padding: 60px 50px; box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            max-width: 600px; border: 2px solid rgba(255,255,255,0.2);
        }
        .logo { 
            font-size: 48px; font-weight: bold; background: linear-gradient(45deg, #d63384, #ff6b9d); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 30px;
        }
        h1 { font-size: 32px; margin-bottom: 20px; }
        .subtitle { font-size: 18px; opacity: 0.9; margin-bottom: 40px; }
        .launch-btn { 
            background: linear-gradient(45deg, #28a745, #20c997); color: white; 
            border: none; padding: 20px 60px; border-radius: 50px; font-size: 20px; 
            font-weight: bold; cursor: pointer; transition: all 0.3s ease; 
            box-shadow: 0 15px 40px rgba(40,167,69,0.4); margin: 20px 0;
        }
        .launch-btn:hover { transform: translateY(-5px); box-shadow: 0 25px 60px rgba(40,167,69,0.6); }
        .launch-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .status { 
            padding: 20px; border-radius: 15px; margin: 20px 0; font-size: 16px; 
            min-height: 60px; display: flex; align-items: center; justify-content: center;
        }
        .status.loading { background: rgba(255,255,255,0.1); color: #fff; }
        .status.error { background: rgba(220,53,69,0.2); color: #ffb3b3; border: 1px solid #dc3545; }
    </style>
</head>
<body>
    <div class="launch-container">
        <div class="logo">ğŸš¨ Sepsis Monitor</div>
        <h1>æ•—è¡€ç—‡æ—©æœŸç›£æ§ç³»çµ±</h1>
        <p class="subtitle">SMART on FHIR è‡¨åºŠæ±ºç­–æ”¯æ´ä»‹é¢</p>
        
        <div id="status" class="status loading">æ­£åœ¨åˆå§‹åŒ– SMART å•Ÿå‹•åºåˆ—...</div>
        
        <button id="launchBtn" class="launch-btn" style="display: none;" onclick="doLaunch()">
            ğŸš€ å•Ÿå‹•ç³»çµ±
        </button>

        <div style="margin-top: 30px; font-size: 14px; opacity: 0.7;">
            ç›®æ¨™ä¼ºæœå™¨: THAS FHIR (è¡›ç¦éƒ¨)
        </div>
    </div>

    <script>
        // SMART å•Ÿå‹•é…ç½®
        const config = {
            clientId: "my_sepsis_app", // æ‡‰èˆ‡ FHIR Server è¨»å†Šçš„ Client ID ä¸€è‡´
            scope: "patient/*.read patient/*.write openid fhirUser",
            redirectUri: "index.html" // æˆæ¬Šå¾Œè·³è½‰è‡³æ‚¨çš„å„€è¡¨æ¿
        };

        async function init() {
            try {
                // æª¢æŸ¥æ˜¯å¦å¾ EHR å•Ÿå‹• (å«æœ‰ launch åƒæ•¸)
                const params = new URLSearchParams(window.location.search);
                if (params.has('launch') && params.has('iss')) {
                    document.getElementById('status').innerHTML = "âœ… å·²æª¢æ¸¬åˆ° EHR å•Ÿå‹•ä¿¡è™Ÿ";
                    document.getElementById('launchBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('status').className = "status error";
                    document.getElementById('status').innerHTML = "âŒ éŒ¯èª¤ï¼šæœªæª¢æ¸¬åˆ°å•Ÿå‹•åƒæ•¸ (Launch Context)ã€‚<br>è«‹å¾ EHR ç³»çµ±å•Ÿå‹•æ­¤ Appã€‚";
                }
            } catch (e) {
                document.getElementById('status').className = "status error";
                document.getElementById('status').innerHTML = "ç³»çµ±ç•°å¸¸: " + e.message;
            }
        }

        function doLaunch() {
            document.getElementById('launchBtn').disabled = true;
            document.getElementById('launchBtn').textContent = "è·³è½‰ä¸­...";
            
            // åŸ·è¡Œ SMART æˆæ¬Šé‡å®šå‘
            FHIR.oauth2.authorize({
                clientId: config.clientId,
                scope: config.scope,
                redirectUri: config.redirectUri
            });
        }

        // é é¢è¼‰å…¥å¾Œåˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>