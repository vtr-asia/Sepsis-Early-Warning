<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SepsisGuard | æ•—è¡€ç—‡æ—©æœŸé è­¦ç³»çµ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4f46e5;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --sidebar-bg: #ffffff;
            --main-bg: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', 'Noto Sans TC', sans-serif; 
            background: var(--main-bg); color: #1e293b;
            display: flex; height: 100vh; overflow: hidden;
        }

        /* Sidebar æ¨£å¼ */
        .sidebar { 
            width: 350px; background: var(--sidebar-bg); border-right: 1px solid #e2e8f0;
            padding: 30px; display: flex; flex-direction: column; z-index: 100;
        }
        .logo { font-size: 26px; font-weight: 800; color: var(--primary); margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        
        .patient-card {
            background: #f1f5f9; border-radius: 16px; padding: 20px; border: 2px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; margin-bottom: 15px;
        }
        .patient-card.active { border-color: var(--primary); background: #eef2ff; transform: scale(1.02); }
        .patient-card.high-risk { border-left: 6px solid var(--danger); }

        /* ä¸»é¢æ¿æ¨£å¼ */
        .main { flex: 1; padding: 40px; overflow-y: auto; position: relative; transition: background 0.5s; }
        .emergency-bg { animation: dangerPulse 2s infinite; }
        @keyframes dangerPulse { 
            0% { background: #f8fafc; } 
            50% { background: #fef2f2; } 
            100% { background: #f8fafc; } 
        }

        /* é ‚éƒ¨è³‡è¨Šæ¬„ */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .door-timer { text-align: right; }
        .door-timer .time { font-size: 32px; font-weight: 800; color: var(--primary); font-variant-numeric: tabular-nums; }

        /* å„€è¡¨æ¿å¡ç‰‡ */
        .dashboard-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 30px; }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border-radius: 24px; padding: 30px; border: 1px solid rgba(255,255,255,0.5); box-shadow: 0 10px 30px rgba(0,0,0,0.05); }

        /* qSOFA è¦–è¦º */
        .qsofa-section { margin-bottom: 30px; }
        .qsofa-val { font-size: 80px; font-weight: 800; line-height: 1; color: var(--danger); }
        
        /* æŒ‡æ¨™ç¶²æ ¼ */
        .metrics-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .metric-item { background: #ffffff; padding: 15px; border-radius: 16px; border: 1px solid #f1f5f9; }
        .metric-label { font-size: 14px; color: #64748b; margin-bottom: 5px; }
        .metric-value { font-size: 24px; font-weight: 700; }
        .chart-container { height: 60px; margin-top: 10px; }

        /* CDS Hooks æ¨£å¼ */
        .cds-card { background: #fffbeb; border: 1px solid #fde68a; }
        .cds-alert { display: flex; gap: 12px; margin-top: 15px; font-size: 15px; color: #92400e; line-height: 1.5; }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; transition: 0.3s; font-size: 15px; width: 100%; margin-top: 10px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-2px); }
        .btn-ghost { background: transparent; border: 1px solid #e2e8f0; color: #64748b; }

        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; background: var(--danger); animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.2; } }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><span>ğŸ©º</span> SepsisGuard</div>
        
        <div style="font-size: 12px; color: #94a3b8; font-weight: 700; margin-bottom: 15px; letter-spacing: 1px;">PATIENT LIST</div>
        <div class="patient-card active high-risk">
            <div style="display:flex; justify-content: space-between;">
                <strong>ç‹å°æ˜</strong>
                <span class="status-dot"></span>
            </div>
            <div style="font-size: 12px; color: #64748b; margin-top: 5px;">ID: patient-123</div>
            <div style="margin-top: 10px;"><span style="background: #fee2e2; color: #ef4444; font-size: 11px; padding: 2px 8px; border-radius: 4px; font-weight: 800;">CRITICAL: qSOFA 2</span></div>
        </div>

        <div style="margin-top: auto;">
            <button class="btn btn-primary" id="startBtn" onclick="toggleMonitoring()">â–¶ é–‹å§‹å³æ™‚ç›£æ¸¬</button>
            <button class="btn btn-ghost" onclick="uploadFHIR()">ğŸ’¾ åŒæ­¥è‡³ THAS</button>
            <div id="uploadStatus" style="display:none; font-size: 12px; color: var(--success); margin-top: 10px; text-align: center;">âœ… FHIR Resource å·²ä¸Šå‚³</div>
        </div>
    </div>

    <div class="main" id="mainPanel">
        <div class="header">
            <div>
                <h1 style="font-size: 24px; font-weight: 800;">æ•—è¡€ç—‡è‡¨åºŠæ±ºç­–å„€è¡¨æ¿</h1>
                <p style="color: #64748b;">æœ€å¾ŒåŒæ­¥æ™‚é–“ï¼š<span id="syncTime">--:--:--</span></p>
            </div>
            <div class="door-timer">
                <div style="font-size: 12px; font-weight: 700; color: #64748b;">é»ƒé‡‘æ²»ç™‚æ™‚é–“ (Door-to-Antibiotic)</div>
                <div class="time" id="doorTime">00:12:45</div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="glass-card">
                <div class="qsofa-section">
                    <div style="background: #fee2e2; color: #b91c1c; display: inline-block; padding: 4px 12px; border-radius: 99px; font-size: 12px; font-weight: 700; margin-bottom: 10px;">âš ï¸ SEPSIS WARNING TRIGGERED</div>
                    <div style="display: flex; align-items: baseline; gap: 20px;">
                        <span class="qsofa-val" id="qsofaValue">2</span>
                        <span style="font-size: 24px; font-weight: 700; color: #475569;">qSOFA Score</span>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-item">
                        <div class="metric-label">ğŸŒ¡ï¸ é«”æº« (Temperature)</div>
                        <div class="metric-value" id="tempText" style="color: var(--danger);">39.0Â°C</div>
                        <div class="chart-container"><canvas id="tempChart"></canvas></div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">ğŸ« å‘¼å¸ç‡ (RR)</div>
                        <div class="metric-value" id="rrText" style="color: var(--danger);">27 bpm</div>
                        <div class="chart-container"><canvas id="rrChart"></canvas></div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">ğŸ©¸ æ”¶ç¸®å£“ (SBP)</div>
                        <div class="metric-value" id="bpText" style="color: var(--danger);">92 mmHg</div>
                        <div class="chart-container"><canvas id="bpChart"></canvas></div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">ğŸ§ª ä¹³é…¸ (Lactate)</div>
                        <div class="metric-value" id="lactateText">3.5 mmol/L</div>
                        <div class="chart-container"><canvas id="lactateChart"></canvas></div>
                    </div>
                </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 30px;">
                <div class="glass-card cds-card">
                    <h3 style="font-size: 18px; display: flex; align-items: center; gap: 8px;">ğŸ’¡ CDS ä»‹å…¥å»ºè­°</h3>
                    <div class="cds-alert"><span>ğŸ“</span><strong>ç«‹å³é€²è¡Œè¡€æ¶²åŸ¹é¤Š (Blood Cultures)</strong></div>
                    <div class="cds-alert"><span>ğŸ“</span><strong>å•Ÿå‹•å»£æ•ˆæ€§æŠ—ç”Ÿç´  (Empiric Antibiotics)</strong></div>
                    <div class="cds-alert" style="margin-bottom: 20px;"><span>ğŸ“</span><strong>è¼¸æ¶²æ²»ç™‚å»ºè­°ï¼š30mL/kg Crystalloid</strong></div>
                    <button class="btn btn-primary" style="background: #92400e;" onclick="alert('è—¥ç‰©è™•æ–¹ MedicationRequest å·²å‚³é€è‡³é†«å›‘ç³»çµ±')">ğŸš€ åŸ·è¡Œå»ºè­°è™•æ–¹</button>
                </div>

                <div class="glass-card" style="flex: 1;">
                    <h3 style="font-size: 16px; margin-bottom: 15px;">ğŸ“Š æ•¸æ“šå‚³è¼¸æ­·å² (FHIR)</h3>
                    <div id="fhirHistory" style="font-size: 12px; color: #64748b; line-height: 2;">
                        <div>ğŸ•’ 12:00:05 - Observation/695171 Created</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isMonitoring = false;
        let charts = {};
        const config = {
            temp: { color: '#ef4444', data: [38.2, 38.5, 38.4, 38.8, 38.9, 39.0] },
            rr: { color: '#f59e0b', data: [22, 24, 25, 23, 26, 27] },
            bp: { color: '#3b82f6', data: [105, 100, 98, 95, 94, 92] },
            lactate: { color: '#8b5cf6', data: [2.1, 2.5, 2.8, 3.2, 3.4, 3.5] }
        };

        // åˆå§‹åŒ– Chart.js
        function initCharts() {
            Object.keys(config).forEach(key => {
                const ctx = document.getElementById(`${key}Chart`).getContext('2d');
                charts[key] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['', '', '', '', '', ''],
                        datasets: [{
                            data: config[key].data,
                            borderColor: config[key].color,
                            borderWidth: 3,
                            fill: true,
                            backgroundColor: config[key].color + '15',
                            tension: 0.4,
                            pointRadius: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { x: { display: false }, y: { display: false } }
                    }
                });
            });
        }

        // åˆ‡æ›ç›£æ§ç‹€æ…‹
        function toggleMonitoring() {
            isMonitoring = !isMonitoring;
            const btn = document.getElementById('startBtn');
            const mainPanel = document.getElementById('mainPanel');
            
            if (isMonitoring) {
                btn.textContent = "â¸ åœæ­¢ç›£æ¸¬";
                btn.style.background = "#64748b";
                mainPanel.classList.add('emergency-bg');
                startDataStream();
            } else {
                location.reload(); // ç°¡å–®é‡ç½®
            }
        }

        // æ¨¡æ“¬æ•¸æ“šæµ
        function startDataStream() {
            setInterval(() => {
                if (!isMonitoring) return;

                // æ¨¡æ“¬æ•¸æ“šè®ŠåŒ–
                const newTemp = 38.5 + Math.random();
                const newRR = 24 + Math.floor(Math.random() * 5);
                const newBP = 90 + Math.floor(Math.random() * 10);
                const newLac = 3.0 + Math.random();

                // æ›´æ–°æ–‡å­—
                document.getElementById('tempText').textContent = newTemp.toFixed(1) + 'Â°C';
                document.getElementById('rrText').textContent = newRR + ' bpm';
                document.getElementById('bpText').textContent = newBP + ' mmHg';
                document.getElementById('lactateText').textContent = newLac.toFixed(1) + ' mmol/L';
                document.getElementById('syncTime').textContent = new Date().toLocaleTimeString();

                // æ›´æ–°åœ–è¡¨
                updateChart(charts.temp, newTemp);
                updateChart(charts.rr, newRR);
                updateChart(charts.bp, newBP);
                updateChart(charts.lactate, newLac);
            }, 3000);
        }

        function updateChart(chart, value) {
            chart.data.datasets[0].data.push(value);
            chart.data.datasets[0].data.shift();
            chart.update('none');
        }

        function uploadFHIR() {
            const status = document.getElementById('uploadStatus');
            const history = document.getElementById('fhirHistory');
            status.style.display = 'block';
            const log = document.createElement('div');
            log.textContent = `ğŸ•’ ${new Date().toLocaleTimeString()} - Bundle Transaction Success (ID: ${Math.floor(Math.random()*1000000)})`;
            history.prepend(log);
        }

        // è¨ˆæ™‚å™¨å‹•ç•«
        setInterval(() => {
            const timeEl = document.getElementById('doorTime');
            let [m, s] = timeEl.textContent.split(':').slice(1).map(Number);
            s++;
            if (s === 60) { s = 0; m++; }
            timeEl.textContent = `00:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        }, 1000);

        window.onload = initCharts;
    </script>
</body>
</html>